<div class="col-sm-12 col-lg-6">

  <div class="panel panel-default" ng-show="$ctrl.error">
    <div class="panel-heading">
      <h3 class="panel-title">Couldn't load settings</h3>
    </div>
    <div class="panel-body">
      Setting could not be loaded.
    </div>
  </div>

  <oa-loading-panel message="Settings are loading..."
                    ng-show="!$ctrl.error && !$ctrl.model.$resolved"></oa-loading-panel>

  <form ng-show="!$ctrl.error && $ctrl.model.$resolved" name="settingsForm" role="form" class="form-horizontal"
        novalidate oa-check-form>
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Settings</h3>
      </div>
      <div class="panel-body">

        <legend>DeepSea / Salt REST API</legend>

        <!-- Salt API Host -->
        <div class="form-group"
             ng-class="{'has-error': (settingsForm.$submitted || settingsForm['saltApiHost'].$dirty) && settingsForm['saltApiHost'].$invalid}">
          <label class="col-sm-3 control-label" for="saltApiHost">Hostname / IP Address</label>
          <div class="col-sm-9">
            <input type="text" class="form-control" name="saltApiHost" id="saltApiHost"
                   ng-model="$ctrl.model.deepsea.host" ng-change="$ctrl.checkDeepSeaConnection()" required>
            <span class="help-block tc_saltApiHostRequired"
                  ng-show="(settingsForm.$submitted || settingsForm['saltApiHost'].$dirty) && settingsForm['saltApiHost'].$error.required">
              Required field
            </span>
          </div>
        </div>

        <!-- Salt API Port -->
        <div class="form-group"
             ng-class="{'has-error': (settingsForm.$submitted || settingsForm['saltApiPort'].$dirty) && settingsForm['saltApiPort'].$invalid}">
          <label class="col-sm-3 control-label" for="saltApiPort">TCP port</label>
          <div class="col-sm-9">
            <input type="number" class="form-control" name="saltApiPort" id="saltApiPort"
                   ng-model="$ctrl.model.deepsea.port" ng-change="$ctrl.checkDeepSeaConnection()" required>
            <span class="help-block tc_saltApiPortRequired"
                  ng-show="(settingsForm.$submitted || settingsForm['saltApiPort'].$dirty) && settingsForm['saltApiPort'].$error.required">
              Required field
            </span>
          </div>
        </div>

        <!-- Salt API Eauth -->
        <div class="form-group"
             ng-class="{'has-error': (settingsForm.$submitted || settingsForm['saltApiEauth'].$dirty) && settingsForm['saltApiEauth'].$invalid}">
          <label class="col-sm-3 control-label" for="saltApiEauth">External Auth System</label>
          <div class="col-sm-9">
            <select class="form-control"
                    ng-model="$ctrl.model.deepsea.eauth"
                    ng-options="eauth for eauth in ['auto', 'sharedsecret']"
                    name="saltApiEauth"
                    id="saltApiEauth"
                    ng-change="$ctrl.checkDeepSeaConnection()"
                    required>
              <option value="">-- Select the external auth system --</option>
            </select>
            <span class="help-block tc_saltApiEauthRequired"
                  ng-show="(settingsForm.$submitted || settingsForm['saltApiEauth'].$dirty) && settingsForm['saltApiEauth'].$error.required">
              Required field
            </span>
          </div>
        </div>

        <!-- Salt API Username -->
        <div class="form-group"
             ng-class="{'has-error': (settingsForm.$submitted || settingsForm['saltApiUsername'].$dirty) && settingsForm['saltApiUsername'].$invalid}"
             ng-if="$ctrl.model.deepsea.eauth === 'auto' || $ctrl.model.deepsea.eauth === 'sharedsecret'">
          <label class="col-sm-3 control-label" for="saltApiUsername">Username</label>
          <div class="col-sm-9">
            <input type="text" class="form-control" name="saltApiUsername" id="saltApiUsername"
                   ng-model="$ctrl.model.deepsea.username" ng-change="$ctrl.checkDeepSeaConnection()" required>
            <span class="help-block tc_saltApiUsernameRequired"
                  ng-show="(settingsForm.$submitted || settingsForm['saltApiUsername'].$dirty) && settingsForm['saltApiUsername'].$error.required">
              Required field
            </span>
          </div>
        </div>

        <!-- Salt API Shared Secret -->
        <div class="form-group"
             ng-class="{'has-error': (settingsForm.$submitted || settingsForm['saltApiSharedSecret'].$dirty) && settingsForm['saltApiSharedSecret'].$invalid}"
             ng-if="$ctrl.model.deepsea.eauth === 'sharedsecret'">
          <label class="col-sm-3 control-label" for="saltApiSharedSecret">Shared Secret</label>
          <div class="col-sm-9">
            <input type="text" class="form-control" name="saltApiSharedSecret" id="saltApiSharedSecret"
                   ng-model="$ctrl.model.deepsea.shared_secret" ng-change="$ctrl.checkDeepSeaConnection()" required>
            <span class="help-block tc_saltApiSharedSecretRequired"
                  ng-show="(settingsForm.$submitted || settingsForm['saltApiSharedSecret'].$dirty) && settingsForm['saltApiSharedSecret'].$error.required">
              Required field
            </span>
          </div>
        </div>

        <div class="pull-right">
          <span ng-if="$ctrl.deepseaConnectionStatus.loading">
            <i class="fa fa-spinner fa-spin fa-fw" aria-hidden="true"></i> Checking connection
          </span>
          <span class="text-success tc_deepseaConnectionSuccess" ng-show="$ctrl.deepseaConnectionStatus.success === true">
            <i class="fa fa-check" aria-hidden="true"></i> Salt API connection successfull
          </span>
          <span class="text-danger tc_deepseaConnectionFail" ng-show="$ctrl.deepseaConnectionStatus.success === false">
            <i class="fa fa-times" aria-hidden="true"></i> Salt API connection failed
          </span>
        </div>
        <br>
        <div class="pull-right">
          <span class="text-muted" ng-if="$ctrl.deepseaConnectionStatus.message">
            {{ $ctrl.deepseaConnectionStatus.message }} - <a ng-click="$ctrl.checkDeepSeaConnection()">retry</a>
          </span>
          <span ng-if="!$ctrl.deepseaConnectionStatus.message">&nbsp;</span>
        </div>

        <legend>Object Gateway</legend>

        <!-- Object Gateway Managed by DeepSea -->
        <div class="form-group">
          <div class="col-sm-offset-3 col-sm-9">
            <div class="checkbox checkbox-primary">
              <input type="checkbox" ng-model="$ctrl.model.rgw.managed_by_deepsea" name="active"
                     id="rgwManagedByDeepSea" ng-change="$ctrl.rgwManagedByDeepSeaChangeHandler()"
                     ng-disabled="!$ctrl.managedByDeepSeaEnabled">
              <label for="rgwManagedByDeepSea">
                Managed by DeepSea
                <span ng-if="!$ctrl.managedByDeepSeaEnabled" class="text-muted">
                  (DeepSea is not able to provide Object Gateway credentials)
                </span>
              </label>
            </div>
          </div>
        </div>

        <!-- Object Gateway Host -->
        <div class="form-group">
          <label class="col-sm-3 control-label" for="rgwApiHost">Hostname / IP Address</label>
          <div class="col-sm-9">
            <input type="text" class="form-control" name="rgwApiHost" id="rgwApiHost"
                   ng-model="$ctrl.model.rgw.host" ng-change="$ctrl.checkRgwConnection()"
                   ng-disabled="$ctrl.model.rgw.managed_by_deepsea">
          </div>
        </div>

        <!-- Object Gateway Port -->
        <div class="form-group">
          <label class="col-sm-3 control-label" for="rgwApiPort">TCP port</label>
          <div class="col-sm-9">
            <input type="text" class="form-control" name="rgwApiPort" id="rgwApiPort"
                   ng-model="$ctrl.model.rgw.port" ng-change="$ctrl.checkRgwConnection()"
                   ng-disabled="$ctrl.model.rgw.managed_by_deepsea">
          </div>
        </div>

        <!-- Object Gateway Access Key -->
        <div class="form-group">
          <label class="col-sm-3 control-label" for="rgwApiAccessKey">Access Key</label>
          <div class="col-sm-9">
            <input type="text" class="form-control" name="rgwApiAccessKey" id="rgwApiAccessKey"
                   ng-model="$ctrl.model.rgw.access_key" ng-change="$ctrl.checkRgwConnection()"
                   ng-disabled="$ctrl.model.rgw.managed_by_deepsea">
          </div>
        </div>

        <!-- Object Gateway Secret Key -->
        <div class="form-group">
          <label class="col-sm-3 control-label" for="rgwApiSecretKey">Secret Key</label>
          <div class="col-sm-9">
            <input type="text" class="form-control" name="rgwApiSecretKey" id="rgwApiSecretKey"
                   ng-model="$ctrl.model.rgw.secret_key" ng-change="$ctrl.checkRgwConnection()"
                   ng-disabled="$ctrl.model.rgw.managed_by_deepsea">
          </div>
        </div>

        <!-- Object Gateway Admin User -->
        <div class="form-group">
          <label class="col-sm-3 control-label" for="rgwApiAdminUser">Admin User</label>
          <div class="col-sm-9">
            <input type="text" class="form-control" name="rgwApiAdminUser" id="rgwApiAdminUser"
                   ng-model="$ctrl.model.rgw.user_id" ng-change="$ctrl.checkRgwConnection()"
                   ng-disabled="$ctrl.model.rgw.managed_by_deepsea">
          </div>
        </div>

        <!-- Object Gateway Admin Resource Path -->
        <div class="form-group">
          <label class="col-sm-3 control-label" for="rgwApiAdminResourcePath">Admin Resource Path</label>
          <div class="col-sm-9">
            <input type="text" class="form-control" name="rgwApiAdminResourcePath" id="rgwApiAdminResourcePath"
                   ng-model="$ctrl.model.rgw.admin_path" ng-change="$ctrl.checkRgwConnection()"
                   ng-disabled="$ctrl.model.rgw.managed_by_deepsea">
          </div>
        </div>

        <!-- Object Use SSL -->
        <div class="form-group">
          <div class="col-sm-offset-3 col-sm-9">
            <div class="checkbox checkbox-primary">
              <input type="checkbox" ng-model="$ctrl.model.rgw.use_ssl" name="active"
                     id="rgwUseSSL" ng-change="$ctrl.checkRgwConnection()"
                     ng-disabled="$ctrl.model.rgw.managed_by_deepsea">
              <label for="rgwUseSSL">
                Use SSL
              </label>
            </div>
          </div>
        </div>

        <div class="pull-right">
          <span ng-if="$ctrl.rgwConnectionStatus.loading">
            <i class="fa fa-spinner fa-spin fa-fw" aria-hidden="true"></i> Checking connection
          </span>
          <span class="text-success tc_rgwConnectionSuccess" ng-show="$ctrl.rgwConnectionStatus.success === true">
            <i class="fa fa-check" aria-hidden="true"></i> Object Gateway API connection successfull
          </span>
          <span class="text-danger tc_rgwConnectionFail" ng-show="$ctrl.rgwConnectionStatus.success === false">
            <i class="fa fa-times" aria-hidden="true"></i> Object Gateway API connection failed
          </span>
        </div>
        <br>
        <div class="pull-right">
          <span class="text-muted" ng-if="$ctrl.rgwConnectionStatus.message">
            {{ $ctrl.rgwConnectionStatus.message }} - <a ng-click="$ctrl.checkRgwConnection()">retry</a>
          </span>
          <span ng-if="!$ctrl.rgwConnectionStatus.message">&nbsp;</span>
        </div>

        <legend>Grafana</legend>

        <!-- Grafana Host -->
        <div class="form-group">
          <label class="col-sm-3 control-label" for="grafanaApiHost">Hostname / IP Address</label>
          <div class="col-sm-9">
            <input type="text" class="form-control" name="grafanaApiHost" id="grafanaApiHost"
                   ng-model="$ctrl.model.grafana.host" ng-change="$ctrl.checkGrafanaConnection()">
          </div>
        </div>

        <!-- Grafana Port -->
        <div class="form-group">
          <label class="col-sm-3 control-label" for="grafanaApiPort">TCP port</label>
          <div class="col-sm-9">
            <input type="text" class="form-control" name="grafanaApiPort" id="grafanaApiPort"
                   ng-model="$ctrl.model.grafana.port" ng-change="$ctrl.checkGrafanaConnection()">
          </div>
        </div>

        <!-- Grafana Username -->
        <div class="form-group">
          <label class="col-sm-3 control-label" for="grafanaApiUsername">Username</label>
          <div class="col-sm-9">
            <input type="text" class="form-control" name="grafanaApiUsername" id="grafanaApiUsername"
                   ng-model="$ctrl.model.grafana.username" ng-change="$ctrl.checkGrafanaConnection()">
          </div>
        </div>

        <!-- Grafana Password -->
        <div class="form-group">
          <label class="col-sm-3 control-label" for="grafanaApiPassword">Password</label>
          <div class="col-sm-9">
            <input type="text" class="form-control" name="grafanaApiPassword" id="grafanaApiPassword"
                   ng-model="$ctrl.model.grafana.password" ng-change="$ctrl.checkGrafanaConnection()">
          </div>
        </div>

        <!-- Grafana Use SSL -->
        <div class="form-group">
          <div class="col-sm-offset-3 col-sm-9">
            <div class="checkbox checkbox-primary">
              <input type="checkbox" ng-model="$ctrl.model.grafana.use_ssl" name="active"
                     id="grafanaUseSSL" ng-change="$ctrl.checkGrafanaConnection()">
              <label for="grafanaUseSSL">
                Use SSL
              </label>
            </div>
          </div>
        </div>

        <div class="pull-right">
          <span ng-if="$ctrl.grafanaConnectionStatus.loading">
            <i class="fa fa-spinner fa-spin fa-fw" aria-hidden="true"></i> Checking connection
          </span>
          <span class="text-success tc_grafanaConnectionSuccess" ng-show="$ctrl.grafanaConnectionStatus.success === true">
            <i class="fa fa-check" aria-hidden="true"></i> Grafana connection successfull
          </span>
          <span class="text-danger tc_grafanaConnectionFail" ng-show="$ctrl.grafanaConnectionStatus.success === false">
            <i class="fa fa-times" aria-hidden="true"></i> Grafana connection failed
          </span>
        </div>
        <br>
        <div class="pull-right">
          <span class="text-muted" ng-if="$ctrl.grafanaConnectionStatus.message">
            {{ $ctrl.grafanaConnectionStatus.message }} - <a ng-click="$ctrl.checkGrafanaConnection()">retry</a>
          </span>
          <span ng-if="!$ctrl.grafanaConnectionStatus.message">&nbsp;</span>
        </div>

      </div>

      <div class="panel-footer">
        <div class="button-group text-right">
          <button type="submit" class="btn btn-sm btn-primary tc_submitButton"
                  ng-disabled="settingsForm.$invalid || settingsForm.$submitted"
                  ng-click="$ctrl.saveAction()">
            Save
            <i class="fa fa-spinner fa-spin fa-fw" ng-if="settingsForm.$submitted"></i>
          </button>
        </div>
      </div>
    </div>
  </form>
</div>
