# This file is generated automatically by openATTIC and will be overwritten
# automatically when the configuration changes.
#
# To alter sections of this file, edit `<openATTIC>/samba/templates/samba/smb.conf`,
# and run `<openATTIC>/installer.py -c -o samba` to update smbd.

[global]
   workgroup = {{ Workgroup|upper }}
   server string = %h server (Samba, openATTIC)
   dns proxy = no
   log file = /var/log/samba/log.%m
   max log size = 1000
   syslog = 0
   panic action = /usr/share/samba/panic-action %d
   encrypt passwords = true
   passdb backend = tdbsam
   obey pam restrictions = yes
   unix password sync = yes
   passwd program = /usr/bin/passwd %u
   passwd chat = *Enter\snew\s*\spassword:* %n\n *Retype\snew\s*\spassword:* %n\n *password\supdated\ssuccessfully* .
   pam password change = yes
   map to guest = bad user
   usershare allow guests = yes
   {% if Domain %}
   security = ADS
   realm = {{ Domain|upper }}
   netbios name = {{ Hostname|upper }}
   domain master = no
   client use spnego = yes

   idmap uid = 500-10000000
   idmap gid = 500-10000000
   winbind separator = +
   winbind enum users = no
   winbind enum groups = no
   winbind use default domain = yes

   template shell = /bin/true
   {% else %}
   security = share
   {% endif %}


[printers]
   comment = All Printers
   browseable = no
   path = /var/spool/samba
   printable = yes
   guest ok = no
   read only = yes
   create mask = 0700

[print$]
   comment = Printer Drivers
   path = /var/lib/samba/printers
   browseable = yes
   read only = yes
   guest ok = no

{% for share in Shares %}
[{{ share.volume.name }}]
   path = {{ share.path }}
   available = {{ share.available|yesno }}
   browseable = {{ share.browseable|yesno }}
   guest ok = {{ share.guest_ok|yesno }}
   writeable = {{ share.writeable|yesno }}
   #write list = hallo,fufu
   create mode = {{ share.create_mode }}
   directory mode = {{ share.dir_mode }}
   {% if share.comment             %}comment = {{ share.comment                 }}{% endif %}
   {% if share.force_user          %}force user  = {{ share.force_user          }}{% endif %}
   {% if share.force_group         %}force group = {{ share.force_group         }}{% endif %}
   {% if share.valid_users.count   %}valid users   = {{ share.valid_users_str   }}{% endif %}
   {% if share.invalid_users.count %}invalid users = {{ share.invalid_users_str }}{% endif %}
   {% if share.read_list.count     %}read list     = {{ share.read_list_str     }}{% endif %}
   {% if share.write_list.count    %}write list    = {{ share.write_list_str    }}{% endif %}
{% endfor %}
