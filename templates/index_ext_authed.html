{% load i18n %}
{% comment %}
 Copyright (C) 2011-2012, it-novum GmbH <community@open-attic.org>

 openATTIC is free software; you can redistribute it and/or modify it
 under the terms of the GNU General Public License as published by
 the Free Software Foundation; version 2.

 This package is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.
{% endcomment %}
<html>
  <head>
    <title>openATTIC</title>
    <link rel="shortcut icon" href="{{ MEDIA_URL }}/openattic_favicon.png" type="image/png" />
    <link rel="stylesheet" href="{{ MEDIA_URL }}/extjs/resources/css/ext-all.css" />
    {% if THEME %}
      <link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}/extjs/resources/css/ext-all-{{ THEME }}.css" />
    {% endif %}
    <script src="{{ MEDIA_URL }}/extjs/ext-all-debug.js"></script>
    {% if LANGUAGE_CODE %}
      <script src="{{ MEDIA_URL }}/extjs/locale/ext-lang-{{ LANGUAGE_CODE }}.js"></script>
    {% endif %}
    <script src="{% url django.views.i18n.javascript_catalog %}"></script>
    <script src="{{ PROJECT_URL }}/userprefs/initprefs.js"></script>
    <script src="{{ PROJECT_URL }}/direct/api.js"></script>
    <script type="text/javascript">
      window.MainViewModules = [];
      window.SnapAppPlugins = [];
      window.HostAttrPlugins = [];
      window.AddVolumeSettings = [];
      Ext.namespace("Ext.ux");
      window.MEDIA_URL   = '{{ MEDIA_URL  }}';
      window.PROJECT_URL = '{{ PROJECT_URL  }}';
      window.LOGOUT_URL  = '{% url logout %}';
      window.INDEX_URL   = '{% url index  %}';
      window.HOSTNAME    = '{{ LOCALHOST.name }}';
      window.HOSTID      = '{{ LOCALHOST.id}}';
      Ext.BLANK_IMAGE_URL = MEDIA_URL + "/extjs/resources/themes/images/gray/tree/s.gif";
      Ext.namespace("Ext.oa");
      Ext.oa.renderBoolean = function (val, x, store){
        if (val)
          return '<img src="{{ MEDIA_URL }}/oxygen/16x16/actions/dialog-ok-apply.png" title="yes" />';
        return '<img src="{{ MEDIA_URL }}/oxygen/16x16/actions/dialog-cancel.png" title="no" />';
      };
      function toUnicode(val){
        if(val){
          return val.__unicode__;
        }
        return '';
      }
      function get_format_ext(format_type){
        // Translate the Django datetime format extensions into stuff that ExtJS actually understands.
        var fmt = get_format(format_type),
            res = "",
            esc = false;
        for( var i = 0; i < fmt.length; i++ ){
          if(esc){
            res += fmt[i];
            esc = false;
          }
          else if(fmt[i] === '\\'){
            esc = true;
          }
          else{
            res += ({
              b: 'M',
              e: 'T',
              E: 'F',
              f: 'g:i',
              N: 'M',
              P: 'g:i a',
              r: 'D, m M Y H:i:s O'
            }[fmt[i]] || fmt[i]);
          }
        }
        return res;
      }
      Ext.Loader.setPath('Ext.app', '{{ MEDIA_URL }}/portal/classes');
      Ext.Loader.setPath('Ext.oa', '{{ MEDIA_URL }}/js');
    </script>
    <script src="{{ MEDIA_URL }}/js/switchingtreestore.js"></script>
    <script src="{{ MEDIA_URL }}/js/directstateprovider.js"></script>
    <script src="{{ MEDIA_URL }}/js/tipify.js"></script>
    <script src="{{ MEDIA_URL }}/js/dangerousmessage.js"></script>
    <script type="text/javascript">
      Ext.Ajax.on("requestcomplete", function( provider, response, opt ){
        var respdata  = Ext.decode( response.responseText );
        if( respdata.type === "exception" ){
          if( respdata.message === "Access Denied!" ){
            Ext.oa.RedDangerousMessage.alert("Session expired",
              "It seems your session has expired. The page will now be reloaded so you can login again.",
              function(){
                window.location.reload();
              }
            );
          }
          else if( respdata.where ){
            Ext.Msg.alert("Error: " + respdata.message, "<pre>" + respdata.where + "</pre>");
          }
        }
      });
    </script>
    <script src="{% url javascript_main 'recorder' %}"></script>
    <script src="{% url javascript_main 'sharegridpanel' %}"></script>
    <script src="{% url javascript_main 'menutree' %}"></script>
    <script src="{% url javascript_main 'settings' %}"></script>
    <script src="{% url javascript_main 'logout' %}"></script>

    <script src="{{ MEDIA_URL }}/js/Reorderer.js"></script>
    <script src="{{ MEDIA_URL }}/js/ToolbarReorderer.js"></script>
    <script src="{{ MEDIA_URL }}/js/ToolbarDroppable.js"></script>
    {% for apptemplate in INSTALLED_APP_TEMPLATES %}
      {% include apptemplate %}
    {% endfor %}
    <script src="{{ MEDIA_URL }}/js/portlets.js"></script>
    <script src="{{ MEDIA_URL }}/js/mainviewmanager.js"></script>
    <script>
      Ext.onReady( function(){
        Ext.QuickTips.init();

        window.MainViewModules.unshift( Ext.create("Ext.oa.Portal") );

        mainpanel = new Ext.oa.MainViewManager({
          renderTo: document.body,
          toolbarMessages: {
            title:   "{% trans 'Delete Button?' %}",
            message: "{% trans 'Do you really wish to remove this button from the toolbar?' %}"
          }
        });

        function updateLayout(){
          viewsize = {
            width:  Ext.core.Element.getViewWidth(),
            height: Ext.core.Element.getViewHeight()
          };
          mainpanel.setHeight( viewsize.height - 20 );
          mainpanel.setWidth(  viewsize.width  - 40 );
        }
        updateLayout();
        Ext.EventManager.onWindowResize(updateLayout);
      });
    </script>
    <style>
      #mainviewtoolbar-targetEl .x-btn-icon-el {
        margin-top: 6px;
        height: 22px;
      }
      .x-tree-icon-datastore-green {
        background-image: url("{{ MEDIA_URL }}/datastore-check-green.png") !important;
      }
      .x-tree-icon-datastore-gray {
        background-image: url("{{ MEDIA_URL }}/datastore-check-gray.png") !important;
      }
      .x-tree-icon-vm-green {
        background-image: url("{{ MEDIA_URL }}/vm-check-green.png") !important;
      }
      .x-tree-icon-vm-gray {
        background-image: url("{{ MEDIA_URL }}/vm-check-gray.png") !important;
      }
      .x-tree-icon-drive-green {
        background-image: url("{{ MEDIA_URL }}/drive-harddisk-check-green.png") !important;
      }
      .x-tree-icon-drive-gray {
        background-image: url("{{ MEDIA_URL }}/drive-harddisk-check-gray.png") !important;
      }
      .x-tree-icon-db-green {
        background-image: url("{{ MEDIA_URL }}/datacenter-check-green.png") !important;
      }
      .x-tree-icon-db-gray {
        background-image: url("{{ MEDIA_URL }}/datacenter-check-gray.png") !important;
      }
      .x-tree-icon, .x-tree-icon-leaf {
        height: 22px !important;
        width:  22px !important;
      }
      .redmask {
        background-color: #FF0000;
      }
      .yellowmask {
        background-color: #FFFF00;
      }
      .mainviewtoolbar .x-btn-text {
        height: 45px !important;
      }
      img.atticlogo {
        cursor: pointer;
        padding-left: 10px;
        padding-right: 10px;
      }
      div.lv_used_crit .x-progress-bar {
        background-image: url("{{ MEDIA_URL }}/progress_crit.gif");
        border-bottom-color: #993333;
        border-right-color: #2b3333;
        border-top-color: #2b3300;
      }
      div.lv_used_warn .x-progress-bar {
        background-image: url("{{ MEDIA_URL }}/progress_warn.gif");
        border-bottom-color: #A66900;
        border-right-color: #FFB941;
        border-top-color: #A66900;
      }
      div.lv_used_ok .x-progress-bar {
        background-image: url("{{ MEDIA_URL }}/progress_ok.gif");
        border-bottom-color: #332b33;
        border-right-color: #332b33;
        border-top-color: #332b00;
      }
      .form_hint_label {
        font-family:    Lucida Grande,Verdana,Arial,sans-serif;
        font-size:      10px;
        font-weight:    400;
        font-style:     normal;
        color:          #999999;
        margin-left:    110px;
      }
    </style>
  </head>
  <body style="padding: 20px 20px 0; ">
    <noscript>Please enable JavaScript to view openATTIC.</noscript>
  </body>
  <!-- kate: space-indent on; indent-width 2; replace-tabs on; hl Django HTML Template; -->
  <!-- vim:set shiftwidth=2 softtabstop=2 expandtab: -->
</html>
